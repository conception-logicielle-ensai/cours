---
url: /docs/appli-web-templating/
title: üìù Configuration d'une application avec templates HTML, Django.
---

## Websockets

### Qu'est-ce qu'un WebSocket ?

Un WebSocket est un protocole de communication bidirectionnel qui permet une interaction en temps r√©el entre un client et un serveur. 

=> Contrairement au protocole HTTP, qui fonctionne sur un mod√®le requ√™te-r√©ponse, WebSocket √©tablit une connexion persistante o√π les deux parties peuvent envoyer et recevoir des messages √† tout moment.

Ce protocole est particuli√®rement utile pour les applications n√©cessitant des mises √† jour en temps r√©el, comme les chats en ligne, les jeux multijoueurs ou les notifications instantan√©es.

### Un peu de TCP

WebSocket fonctionne au-dessus de TCP (Transmission Control Protocol), qui est un protocole de transport garantissant la livraison fiable des donn√©es. 
Lorsqu'une connexion WebSocket est √©tablie, elle commence par une requ√™te HTTP sp√©ciale appel√©e "handshake".
Une fois le handshake r√©ussi, la connexion passe en mode WebSocket et permet l'√©change de donn√©es en temps r√©el.

### Les acteurs dans une architecture WebSocket

Il existe deux types d'acteurs principaux dans une architecture WebSocket : les clients et les serveurs.

Le client est l'entit√© qui initie la connexion WebSocket en envoyant une requ√™te au serveur. Une fois la connexion √©tablie, il peut envoyer et recevoir des messages en temps r√©el.

Le serveur √©coute les connexions entrantes des clients, g√®re les sessions et transmet les messages aux destinataires appropri√©s. Il est responsable de maintenir la connexion active et de relayer les messages entre les diff√©rents clients.

Ces deux composants travaillent ensemble pour offrir une communication fluide et en temps r√©el, essentielle pour de nombreuses applications modernes.

### Exemple d'impl√©mentation

L'exemple ici pr√©sent√© correspond a l'exemple du cours : https://github.com/conception-logicielle-ensai/exemples-cours/tree/main/cours-4/websocket

On repose sur la librairie l√©g√®re `websockets` et la librairie `asyncio` par practicit√©.

- **C√¥t√© serveur**

```python
import asyncio
import websockets

# Ensemble pour stocker les connexions actives
connected_clients = set()

async def broadcast(message):
    for client in connected_clients:
        await client.send(message)

async def handle_client(websocket):
    # Ajoute le client connect√© √† l'ensemble
    connected_clients.add(websocket)
    print(f"Client connect√©. Total clients : {len(connected_clients)}")

    try:
        async for message in websocket:
            print(f"Message re√ßu : {message}")
            await broadcast(f"Message d'un client : {message}")
    except websockets.exceptions.ConnectionClosed:
        print("Client d√©connect√©.")
    finally:
        # Retire le client de l'ensemble √† sa d√©connexion
        connected_clients.remove(websocket)
        print(f"Client d√©connect√©. Total clients : {len(connected_clients)}")

async def main():
    async with websockets.serve(handle_client, "localhost", 8765):
        print("Serveur WebSocket d√©marr√© sur ws://localhost:8765")
        await asyncio.Future()  # Garde le serveur actif

if __name__ == "__main__":
    asyncio.run(main())
```
> On d√©marre un serveur accesible sur le port 8765

- **C√¥t√© client**

```python
import asyncio
import websockets

async def communicate():
    uri = "ws://localhost:8765"
    async with websockets.connect(uri) as websocket:
        message = "Hello, WebSocket Server!"
        print(f"Envoi : {message}")
        await websocket.send(message)
        response = await websocket.recv()
        print(f"R√©ponse du serveur : {response}")

if __name__ == "__main__":
    asyncio.run(communicate())
```
> On s'y connecte directement puis on broadcast des messages

- Il est √©galement possible de g√©rer une session directement dans le navigateur via l'usage du `Javascript`.

```js
  const socket = new WebSocket("ws://localhost:8765");

        socket.onopen = function(event) {
            console.log("Connexion √©tablie avec le serveur WebSocket");
        };

        socket.onmessage = function(event) {
            console.log("Message re√ßu du serveur :", event.data);
            document.getElementById("messages").innerHTML += `<p>${event.data}</p>`;
        };

        socket.onclose = function(event) {
            console.log("Connexion ferm√©e");
        };

        function sendMessage() {
            const message = "Hello depuis le client javascript !";
            console.log("Envoi :", message);
            socket.send(message);
        }
```

## Travaux pratiques

Mettez en place une premi√®re architecture dans vos projets :
- D√©terminez la solution privil√©gi√©e pour votre projet a partir de ce qui a √©t√© pr√©sent√©
- Renseignez pour la s√©ance courante les technologies https://docs.google.com/spreadsheets/d/1VlfoNcXhhJ2tr3OVYCIBmzutdzA56usssL11lCISgIg/edit?usp=sharing
- En se r√©unissant par groupes, travaillez sur vos projets et pinguez nous quand vous avez besoin de nous : (colonne 4 https://docs.google.com/spreadsheets/d/1VlfoNcXhhJ2tr3OVYCIBmzutdzA56usssL11lCISgIg/edit?usp=sharing)
