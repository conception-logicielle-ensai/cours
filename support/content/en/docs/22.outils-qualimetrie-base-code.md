---
title: üîé Outils d'analyse statique d'une base de code
url: /docs/qualimetrie
---

> L'analyse statique du code consiste √† l'analyser SANS le lancer.

## Petite d√©finition

L‚Äôanalyse du code statique, appel√©e aussi analyse du code source ou r√©vision du code statique, est le processus consistant √† d√©tecter les mauvaises habitudes de codage, les vuln√©rabilit√©s potentielles et les d√©fauts de s√©curit√© dans le code source d‚Äôun logiciel, sans pour autant ex√©cuter ce dernier. Il s‚Äôagit d‚Äôune forme de testing en bo√Æte blanche.

Ce type d‚Äôanalyse permet √† vos √©quipes de rep√©rer les bugs ou vuln√©rabilit√©s que les autres outils et m√©thodes de test, par exemple les r√©visions de code manuelles et les compilateurs, ne rel√®vent g√©n√©ralement pas.

## Quel objectif ?

Se pr√©munir de probl√®mes d'execution √† venir sur un code √©crit, sans avoir a l'executer √† partir d'un sous set de r√®gles, de bonnes pratiques et de contr√¥les sur le code.


## Linting

<img src="https://www.eficode.com/hubfs/application%20management%20blog%20-%20How%20to%20write%20better%20code%20with%20linting,%20formatting,%20and%20analysis%20tools.png"/>

Pour tous les languages en particulier les languages non fortement typ√©s, il est souvent assez utile d'√©tablir des conditions d'acceptation du code source. Pour cela, on utilise en g√©n√©ral des outils de validation ou linter.

En python on utilisera parmi par exemple : `flake8` `pylint` `autopep8`

Dans ces conditions on retrouvera aussi bien des conditions purement stylistiques : utilisation d'espaces plut√¥t que de tabulations, nommage des m√©thodes, ...

Quelques r√®gles sont √©dict√©es dans des propostions d'am√©lioration et d'uniformisation de code de python PEP : 
- PEP 7 https://peps.python.org/pep-0007/
- PEP 8 https://peps.python.org/pep-0008/

Les r√®gles sont modulables par projet et vous √™tes libre de configurer pour votre projet les r√®gles qu'il vous semble pertinent ou non de garder.

> Fun Fact : Vous utilisez d√©j√† un linter sans le savoir dans les IDE mais non configur√©s

Mais √©galement la v√©rification de certaines r√®gles sur le code : 
- V√©rification de la pr√©sence du package pour r√©aliser l'import
- V√©rification de la validit√© de l'usage des fonctions par rapport a la signature des m√©thodes

Exemple d'usages :
```
# exemple avec black
pip3 install pylint
# puis
pylint ./app
# Vous pouvez le lancer depuis partout avec la commande :
pylint $(git ls-files '*.py')
```

> Quel int√™ret me diriez vous : 

Pour le style : La coh√©rence du code, permettre de se fixer des r√®gles entre d√©veloppeurs `as code` qui ensuite sont p√©reinnes et factuelles.
Pour la v√©rification : Eviter les erreurs au lancement du code, et donc anticiper les bugs üêõ

<div class="alert alert-info">
  <strong> Pour aller plus loin </strong> <br/>L'usage et les r√®gles appliqu√©es sont bien entendues param√©trables :  ex : <a href="https://www.codeac.io/documentation/pylint-configuration.html">https://www.codeac.io/documentation/pylint-configuration.html</a>
</div>

## Formatting

<img src="https://i.ytimg.com/vi/j1MbEYhYj_Y/hq720.jpg?sqp=-oaymwEhCK4FEIIDSFryq4qpAxMIARUAAAAAGAElAADIQj0AgKJD&rs=AOn4CLAX3DL8ZBkglQ7rk7uuAURahEw_mA" />


Pour r√©pondre aux besoins de bon respect des r√®gles √©tablies en amont (voir linting). Il peut √™tre pertinent de s'√©quiper d'un formatter, associ√© g√©n√©ralement a l'IDE (Visual studio code / Pycharm).
Les formatters classiques pour python sont : `black` `yapf` `Python-autopep8` `isort`

<div class="alert alert-info">
  <strong> Pour aller plus loin </strong> <br/>Voir aussi : <a href="https://github.com/life4/awesome-python-code-formatters">https://github.com/life4/awesome-python-code-formatters</a>
</div>

Exemple d'usages : 
```
# exemple avec black
pip3 install black
# puis
black --check app
```
> Quel int√™ret me diriez vous :

Etablir des changements seulement de contenu et fonctionnels dans le code permet r√©ellement de ne garder que les changements fonctionnels et non de format lors de l'ajout de fonctionnalit√©.
La relecture est donc facilit√©e. Et les r√®gles √©tablies lors du linting sont appliqu√©es par d√©faut.

<div class="alert alert-info">
  <strong> Pour aller plus loin </strong> <br/>Voir aussi : <a href="https://github.com/life4/awesome-python-code-formatters">https://github.com/life4/awesome-python-code-formatters</a>
</div>


## Security testing (SAST : Static application security testing)

<img src="/images/statique/sast.png">

Les Static Application Security Testing (SAST) sont des outils et des techniques utilis√©s dans le domaine de la s√©curit√© informatique pour identifier les vuln√©rabilit√©s potentielles dans le code source des applications.

Ils permettent de d√©tecter des probl√®mes de s√©curit√© dans le code sans l'executer. 

Les SAST peuvent rep√©rer des vuln√©rabilit√©s telles que les injections SQL, les failles XSS, les erreurs de gestion de la m√©moire, etc. Leur utilisation r√©guli√®re permet de renforcer la s√©curit√© des applications d√®s leur conception et de r√©duire les risques de failles de s√©curit√©.

#### Securit√© : quelques rappels


Pour ce cours nous utiliserons l'outil Snyk mais de nombreux outils permettent de couvrir l'analyse de la s√©curit√© des applications.

Diff√©rent types d'attaque en s√©curit√© informatique: 
- Injection (SQL, texte, ..) ~50% : on manipule les entrants de l'application pour d√©passer les fonctionnalit√©s pr√©vues.
- Cross Site Scripting : On injecte un script dans une application pour qu'elle l'execute ensuite pour effectuer des actions malveillantes
- Failles de s√©curit√© - CVE : Bugs connus contenus dans des librairies et versions des syst√®mes qui sont ensuites exploit√©s.
- Attaque par d√©ni de service - DDOS: attaque pour surcharger l'usage d'un service au niveau r√©seau / m√©moire pour emp√™cher tout ou partie de ses usages possibles.
- Man in the middle : r√©cup√©ration des informations utilisateurs pour usurper son identit√© et donc corrompre un syst√®me d'information


## TP : Mise en place de ces outils sur une base de code

<img src="https://static-00.iconduck.com/assets.00/coding-illustration-2048x1365-yefj2c5b.png" />

Pour ce TP on partira cette fois ci d'un projet d√©j√† √©labor√© par une √©quipe au sein du ssplab. Pr√©dicat.

**https://github.com/InseeFrLab/predicat.git** => disponible fork√© ici : [https://github.com/conception-logicielle-ensai/predicat](https://github.com/conception-logicielle-ensai/predicat)

Pour faciliter la vie des gens, j'ai fork√© ce projet dans le groupe `conception logicielle ensai` sur github, si vous ne voulez pas notifier la personne que vous forkez son projet.

<a href="https://github.com/conception-logicielle-ensai/predicat.git"> https://github.com/conception-logicielle-ensai/predicat.git </a> 


### Exercice 1 : Mise en place 

> (Wait it's git again ? :OOO)

1. Forkez le projet : <a href="https://github.com/conception-logicielle-ensai/predicat.git">https://github.com/conception-logicielle-ensai/predicat.git</a>, pour les gens qui ne sont pas sur github, clonez le directement (passez donc la partie 2)

2. Cloner le repository dans un sous dossier de votre TP, dans votre environnement de travail pr√©f√©r√©

3. Depuis le d√©pot r√©cup√©r√©, suivre les instructions pour l'installation via le README.md, veuillez toutefois a bien faire cela dans le repertoire **app** du d√©pot git, par d√©faut : **predicat/app**

4. Lancez l'application via la commande `uvicorn main:app`, pensez bien a installer les d√©pendances au pr√©alable, et vous pouvez utiliser un environnement virtuel.

<details><summary><b>AIDE 1 (clickable): Comment savoir les d√©pendances n√©cessaires √† l'ex√©cution de l'application ?</b></summary>
<p>
Rappel : 

Pour un projet python, les d√©pendances sont en g√©n√©ral g√©r√©es par pip (https://packaging.python.org/tutorials/installing-packages/) et sont list√©es dans le fichier requirements.txt

```python
pip install -r requirements.txt
```

</p>
</details>

<details><summary><b>AIDE 2 (clickable) : Comment d√©bugguer si l'application qui ne se lance pas / crash ? </b></summary>
<p>

Vous avez probablement mal lu le README.md.

Pour r√©soudre le probl√®me, vous aurez besoin d'un mod√®le. On pourra utiliser le mod√®le de test disponible ici : https://minio.lab.sspcloud.fr/conception-logicielle/model_na2008.bin

Vous devez ensuite enlever du fichier de configuration yaml, les lignes concernant les mod√®les qui ne sont pas le mod√®le 2020_old.

Une fois l'application lanc√©e, vous pouvez la requ√™ter avec votre c lient HTTP pr√©f√©r√© et adapt√© √† votre environnement de travail (curl, navigateur web, insomnia ...) : [http://localhost:8000/label?q=confiture](http://localhost:8000/label?q=confiture) ou encore [http://localhost:8000/label?q=omelette%20du%20fromage](http://localhost:8000/label?q=omelette%20du%20fromage)

Si √ßa ne resoud pas, cherchez par rapport a l'erreur renvoy√©e par la console.

</p>
</details>


### Exercice 2 : Analyse statique du code - Linting / Formatting

Pour cette partie on va analyser le code de l'application pr√©dicat.

Installons les paquets black, isort et pylint.

=> `pip3 install black isort pylint`

- Lancez pylint sur le projet (il applique par d√©faut la config de la PEP8) 

`pylint app` (app √©tant le dossier de l'appli, si vous y √™tes d√©j√† `pylint *.py`)

> Que constatez vous ? Est ce qu'il y a des erreurs? De quel type ?

=> Petit tour d'horizon des erreurs possibles : <a href="https://pylint.readthedocs.io/en/stable/user_guide/messages/messages_overview.html" </a>

- Appliquez le formattage avec black et isort

`black app` et `isort --profile black app`

R√©appliquez votre linter sur l'application. Constatez vous un changement dans la notation du code ? 

> Pour valider un d√©p√¥t de code on peut par exemple se dire qu'on n'autorise pas une note inf√©rieure a 7 pour le projet et s'y tenir.
```
pylint --fail-under=7
```

- Vous pouvez √©galement configurer un fichier `.pylintrc` (format√© en TOML): 

Ce fichier est appliqu√© pour configurer les r√®gles de pylint sur le projet (donc depuis le repertoire o√π on l'execute).

Exemple : 
```
[MESSAGES CONTROL]
# Activer ou d√©sactiver certains types de messages
disable = 
    missing-module-docstring,  # Pas de docstring pour les modules
    missing-function-docstring, # Pas de docstring pour les fonctions

[DESIGN]
# Configuration pour les lignes longues
max-line-length = 120  # Limiter √† 120 caract√®res par ligne

[FORMAT]
# Configuration de formatage
good-names = i,j,k,e,x,run,_)  # Noms "bons" pour les variables

[REPORTS]
# Format de sortie pour les r√©sultats de Pylint
output-format = text  # Format de sortie en texte
```

Vous pouvez en ajouter un et constater que cela r√©duit drastiquement le nombre d'erreurs.


### Exercice 3 : Analyse de la s√©curit√© du code et de ses d√©pendances

- Cr√©ez un compte sur Snyk
- Param√©trez l'acc√®s a votre projet sur l'application par l'onglet :
 Projects => Github => `{user}/predicat`
- Profit !

Si vous avez du temps vous pouvez regarder un peu les r√©sultats sur le projet.

### Exercice 4 : Votre projet

En attendant la fin de la s√©quence, mettez en place les outils sur votre projet. (ou r√©fl√©chissez sur votre projet)
