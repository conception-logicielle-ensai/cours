---
url: /docs/appli-web-templating/
title: üìù Configuration d'une application avec templates HTML, Django.
---

Dans cette partie nous allons voir l'impl√©mentation d'applications web, avec rendu de pages c√¥t√© serveur.

## Interface web et sites web - Contexte

<img src="/images/webservice/htmljscss.jpg" />
Avant d'√™tre rendu comme une belle page c√¥t√© utilisateur, un site web utilise diff√©rents fichiers.

Pour l'exemple du cours on utilise la page : **[https://example.org](https://example.org)** :


### HTML

HTML (HyperText Markup Language) est le language utilis√© pour structurer une page web et son contenu. Par exemple, le contenu peut √™tre organis√© sous forme de paragraphes, d'une liste √† puces ou encore √† l'aide d'images et de tableaux de donn√©es. C'est donc le contenu de base pour tout site web.

- **A retenir** Les fichiers `HTML` : Ils d√©crivent la structure logique d'une page web, d√©finissent le contenu des pages. Ils s'√©crivent a l'aide de balises `Markup` de mani√®re plut√¥t verbeuse.



```html
<!doctype html>
<html>
<head>
    <title>Example Domain</title>

    <meta charset="utf-8" />
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
</head>

<body>
<div>
    <h1>Example Domain</h1>
    <p>This domain is for use in illustrative examples in documents. You may use this
        domain in literature without prior coordination or asking for permission.</p>
    <p><a href="https://www.iana.org/domains/example">More information...</a></p>
</div>
</body>
</html>
```

<div class="alert alert-info">
  <strong> Pour aller plus loin </strong> <br/> 

Vous pouvez par exemple consulter ce code pen simple : 
- [https://codepen.io/jmdejager-dev/pen/YzpoyKb](https://codepen.io/jmdejager-dev/pen/YzpoyKb)

</div>
<div class="alert alert-info">
    <strong> Pour aller plus loin </strong> <br/>

Introduction au HTML, avec explication des balises **canon**.

https://www.w3schools.com/html/html_intro.asp
</div>

### CSS

CSS (Cascading Style Sheets) est le language qui permet de styliser le contenu web. Sans CSS, un site n'a qu'une structure, mais pas de rendu visuel stylis√©. Il est donc n√©cessaire de passer par la configuration de ces feuilles de style pour aboutir a un projet abouti c√¥t√© Web.

- **A retenir** : Les fichiers `CSS` : fichiers de style, ils g√®rent l'apparence des balises pr√©sent√©es.
```css
body {
    background-color: #f0f0f2;
    margin: 0;
    padding: 0;
    font-family: -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
}
div {
    width: 600px;
    margin: 5em auto;
    padding: 2em;
    background-color: #fdfdff;
    border-radius: 0.5em;
    box-shadow: 2px 3px 7px 2px rgba(0,0,0,0.02);
}
a:link, a:visited {
    color: #38488f;
    text-decoration: none;
}
@media (max-width: 700px) {
    div {
        margin: 0 auto;
        width: auto;
    }
}
```
<div class="alert alert-info">
  <strong> 1. Pour aller plus loin </strong> <br/> 

- Exemple de codepen : [https://codepen.io/webrav/pen/gMPppj](https://codepen.io/webrav/pen/gMPppj)

</div>

<div class="alert alert-info">
  <strong> 2. Pour aller plus loin </strong> <br/> 

- Tutoriel qualitatif CSS : https://developer.mozilla.org/en-US/docs/Learn_web_development/Getting_started/Your_first_website/Styling_the_content

</div>

### Javascript 

JavaScript est un langage de programmation qui ajoute de l‚Äôinteractivit√© aux sites web. Cela se produit dans les jeux, dans le comportement des r√©ponses lorsque des boutons sont press√©s, lors de la saisie de donn√©es dans des formulaires, avec des styles dynamiques, des animations, etc. Il permet de modifier le **DOM**, qui est le contexte rendu objet d'un site.

- **A retenir :** Les fichiers `javascript` : √©l√©ments de scripts du site, permettent de r√©aliser des actions sur des √©l√©ments Html ou css.

> Exemple avec un bouton qui affiche un nombre al√©atoire entre 0 et 1 :
```html
<button id="button"type="button">Affichage d'un nombre al√©atoire</button>
<div id="affichage"></div>
```

```javascript
document.getElementById("button").onclick = function() {
    document.getElementById("affichage").innerHTML = Math.random();
};
```

<button id="button" type="button" style="display: inline-block; padding: 10px 20px; background-color: #007bff; color: white; font-size: 16px; border-radius: 5px; cursor: pointer; text-align: center; font-family: Arial, sans-serif;">Affichage d'un nombre al√©atoire</button>
<div id="affichage"></div>
<script>document.getElementById("button").onclick = function() {
    document.getElementById("affichage").innerHTML = Math.random();
};</script>

<div class="alert alert-info">
  <strong> 1. Pour aller plus loin </strong> <br/> 

Un codepen simple : https://codepen.io/rcyou/pen/QEObEZ

</div>

<div class="alert alert-info">
  <strong> 2. Pour aller plus loin </strong> <br/> 

Un codepen bien plus fourni : Une petite application statique qui va chercher des informations sur un pokemon avec une requ√™te http en javascript : https://codepen.io/mikemilio/pen/poXOywy

</div>

<div class="alert alert-info">
  <strong> 3. Pour aller plus loin </strong> <br/> 

Le DOM : [https://www.w3schools.com/js/js_htmldom.asp](https://www.w3schools.com/js/js_htmldom.asp)

</div>


### Templating

Ce qui va nous int√©resser aujourd'hui c'est d'effectuer un rendu des pages c√¥t√© serveur et donc de limiter la logique au maximum √† des traitements internes a notre application : on parle alors de **Server Side Rendering**.

> Cela a diff√©rents avantages / inconv√©nients : notamment un meilleur contr√¥le des requ√™tes ou √©galement la rapidit√© dans le cas d'un cache applicatif.

Nous allons donc ici nous int√©resser au contenu des pages rendues et donc aux fichiers `html` des sites, qu'on va vouloir templatiser et renseigner en fonction de divers informations qu'on aura a l'int√©rieur de nos programmes.

Un petit historique : La plupart des applications web "anciennes" sont en PHP + JS + HTML + CSS pour utiliser la flexibilit√© du php pour la construction de pages `templatis√©es`. 

En python des applications du m√™me type peuvent √™tre construites avec le framework **Django** mais √©galement a l'aide de **FASTAPI**  en faisant renvoyer des pages HTML templatis√©es.

## Templating Engine : Pr√©sentation de Jinja2

<img src="/images/webservice/template-page1.png" />


Un **templating engine** (ou moteur de templating) est un outil utilis√© pour g√©n√©rer dynamiquement du contenu, g√©n√©ralement du HTML, en combinant des donn√©es et un mod√®le de mise en page (template). On s'en sert en g√©n√©ral pour la g√©n√©ration de pages `HTML` c√¥t√© serveur, en injectant les r√©sultats de traitements applicatifs dans des pages.

> NB: Cela permet de s√©parer la logique "service" de la logique vue (CF cours 1)

Jinja2 est un moteur de template pour Python, largement utilis√© dans les frameworks web comme Flask. Il permet de g√©n√©rer du HTML dynamique en utilisant des variables, des boucles et des conditions. Il est √©galement utilis√© dans une myriade d'outils d'o√π la pr√©sentation .

**Voyez plut√¥t** ce template, qui sert pour configurer un fichier a envoyer par mail.

```html
<html>
<body>
    <h1>Bonjour {{ user_name }},</h1>
    <p>Merci de vous √™tre inscrit sur notre plateforme.</p>
    <p>Votre email : {{ user_email }}</p>
    {% if is_admin %}
    <p><strong>Vous avez des privil√®ges administrateurs.</strong></p>
    {% endif %}
    <p>Cordialement,</p>
    <p>L'√©quipe du support du site XXXX</p>
</body>
</html>
```

- Jinja2 utilise des doubles accolades `{{ }}` pour ins√©rer des variables dynamiques dans un template. Ces variables sont remplac√©es lors du rendu du template.
- Jinja2 prend en charge les structures de contr√¥le comme les conditions (`if`), les boucles (`for`) et les filtres (`upper`, `lower`, `length` etc.). Ces structures permettent d'adapter le contenu rendu en fonction des donn√©es.

> Un peu de code 

```python
    with open(os.path.join(chemin_script,"template.html"),"r",encoding="utf-8") as fichier_template:
        contenu_fichier_template = fichier_template.read()
        template_rempli_non_admin=template.render(
            user_name=USER_NAME,user_email=USER_EMAIL,is_admin=False
        )
```
Avec les valeurs `user_name = "antoine"`, `user_email = "antoinebrunetti@gmail.com"` et `is_admin = True`

```html
<html>
<body>
    <h1>Bonjour antoine,</h1>
    <p>Merci de vous √™tre inscrit sur notre plateforme.</p>
    <p>Votre email : antoinebrunetti@gmail.com</p>
    <p><strong>Vous avez des privil√®ges administrateurs.</strong></p>
    <p>Cordialement,</p>
    <p>L'√©quipe de support</p>
</body>
</html>
```

<div class="alert alert-info">
  <strong> Pour aller plus loin 1 </strong> <br/> 

Documentation officielle [https://jinja.palletsprojects.com/en/stable/intro/](https://jinja.palletsprojects.com/en/stable/intro/)
</div>

<div class="alert alert-info">
  <strong> Pour aller plus loin 2 </strong> <br/> 

Acc√©dez a l'exemple con√ßu pour le cours et executez le : [https://github.com/conception-logicielle-ensai/exemples-cours/tree/main/cours-4/web-templating](https://github.com/conception-logicielle-ensai/exemples-cours/tree/main/cours-4/web-templating)

</div>

## Server Side Rendering (SSR) : Exemple avec FastAPI

<img src="/images/webservice/ssr.png" />

Le rendu c√¥t√© serveur (Server Side Rendering, SSR) est une architecture o√π les pages HTML sont g√©n√©r√©es sur le serveur avant d'√™tre envoy√©es au navigateur. Cela permet d'am√©liorer le temps de chargement initial.

> Remarque on utilise aussi souvent cela pour  le r√©f√©rencement (SEO), en particulier pour les moteurs de recherche qui ont du mal √† indexer le contenu rendu c√¥t√© client.

### Principe

Comme vu pr√©c√©demment, `FastAPI` est un framework web rapide pour Python, il permet de mettre a disposition du code via HTTP.

En s'appuyant sur du templating `Jinja` de pages `HTML` on peut donc dynamiquement r√©pondre a des requ√™tes utilisateurs en fabriquant les pages HTML c√¥t√© serveur.

### Mise en oeuvre

Nativement, apr√®s l'installation de jinja2, fastapi permet l'usage des templates pr√©c√©demment pr√©sent√©s : 

- `from fastapi.templating import Jinja2Templates`.

Il suffit d'organiser le code projet ainsi : 
```
projet/
‚îÇ-- templates/
‚îÇ   ‚îÇ-- index.html
‚îÇ-- main.py # ou un autre module main
```

Et d'importer les templates ainsi : 

```python
from fastapi.templating import Jinja2Templates
templates = Jinja2Templates(directory="templates")
```

Exemple de projet simple : [lien vers l'exemple-minimal](https://github.com/conception-logicielle-ensai/exemples-cours/tree/main/cours-4/fastapi-web-templating/exemple-minimal)

Il existe beaucoup d'√©l√©ments de configuration, inspirez vous de la documentation et des exemples de code.

<div class="alert alert-info">
  <strong> Pour aller plus loin 1 </strong> <br/> 


La documentation est ici [https://fastapi.tiangolo.com/advanced/templates/](https://fastapi.tiangolo.com/advanced/templates/)

</div>

<div class="alert alert-info">
  <strong> Pour aller plus loin 2 </strong> <br/> 

Un exemple plus concret pour vous inspirer pour vos projets : [https://github.com/conception-logicielle-ensai/exemples-cours/tree/main/cours-4/fastapi-web-templating/app](https://github.com/conception-logicielle-ensai/exemples-cours/tree/main/cours-4/fastapi-web-templating/app)

</div>


## Django : Le framework "tout en un"

<img src="https://www.djangoproject.com/m/img/logos/django-logo-negative.svg" />

Django est le framework historique de d√©veloppement d'applications avec rendu de template html c√¥t√© serveur. Il propose une myriade de fonctionnalit√©s qui ont la particularit√© d'√™tre dans une approche `opt-in`, on peut activer ou desactiver une fonctionnalit√© par de la configuration applicative.

Il propose une architecture interne impl√©mentant le pattern `MTV (Model-Template-View)` : 
- Mod√®le (Model) : DAO (Data Access Object) - des objets mapp√©s en base de donn√©es accessibles via l'**ORM** interne a django.

> Pour info un ORM, Object Relational Mapping, est un outil cr√©ant un couplage entre un mod√®le de classes et un mod√®le de donn√©es en base de donn√©es, il impl√©mente diff√©rentes m√©thodes pour r√©cup√©rer les objets

- Vue (View) : D√©finition de la logique m√©tier et permet de renvoyer une r√©ponse HTTP adapt√©e a une requ√™te. 

> Il impl√©mente √©galement un `Middleware` : composant interceptant les requ√™tes et leur appliquant des propri√©t√©s => Authentification, session, redirection..

### Configuration

Dans un projet Django, la configuration globale se fait a l'interieur m√™me du projet, ou par variables d'environnements : 

[https://docs.djangoproject.com/fr/5.1/topics/settings/#designating-the-settings](https://docs.djangoproject.com/fr/5.1/topics/settings/#designating-the-settings)

### Documentation externe:

Pour d√©marrer si vous partez sur cette solution :

**Exemple simple**

https://github.com/conception-logicielle-ensai/exemples-cours/tree/main/cours-4/django/exemple_simple

> Il s'agit d'un projet mis en place assez simplement, inspirez vous du README
**Suivez un des tutoriels**

https://openclassrooms.com/fr/courses/7172076-debutez-avec-le-framework-django

https://docs.djangoproject.com/en/5.1/intro/



<div class="alert alert-info">
  <strong> Pour aller plus loin 1</strong> <br/> 

Documentation **overview**: [https://docs.djangoproject.com/en/5.1/intro/overview/](https://docs.djangoproject.com/en/5.1/intro/overview/)

</div>
<div class="alert alert-info">
  <strong> Pour aller plus loin 2</strong> <br/> 

Exemple "avanc√©" : https://github.com/conception-logicielle-ensai/exemples-cours/tree/main/cours-4/django/app le README est √©galement constitu√© a fa√ßon pour vous permettre de d√©marrer.


</div>

<div class="alert alert-info">
  <strong> Pour aller plus loin 3</strong> <br/> 

Django design philosophies : voir [https://docs.djangoproject.com/fr/5.1/misc/design-philosophies/](https://docs.djangoproject.com/fr/5.1/misc/design-philosophies/)

</div>



## Websockets

### Qu'est-ce qu'un WebSocket ?

Un WebSocket est un protocole de communication bidirectionnel qui permet une interaction en temps r√©el entre un client et un serveur. 

=> Contrairement au protocole HTTP, qui fonctionne sur un mod√®le requ√™te-r√©ponse, WebSocket √©tablit une connexion persistante o√π les deux parties peuvent envoyer et recevoir des messages √† tout moment.

Ce protocole est particuli√®rement utile pour les applications n√©cessitant des mises √† jour en temps r√©el, comme les chats en ligne, les jeux multijoueurs ou les notifications instantan√©es.

### Un peu de TCP

WebSocket fonctionne au-dessus de TCP (Transmission Control Protocol), qui est un protocole de transport garantissant la livraison fiable des donn√©es. 
Lorsqu'une connexion WebSocket est √©tablie, elle commence par une requ√™te HTTP sp√©ciale appel√©e "handshake".
Une fois le handshake r√©ussi, la connexion passe en mode WebSocket et permet l'√©change de donn√©es en temps r√©el.

### Les acteurs dans une architecture WebSocket

Il existe deux types d'acteurs principaux dans une architecture WebSocket : les clients et les serveurs.

Le client est l'entit√© qui initie la connexion WebSocket en envoyant une requ√™te au serveur. Une fois la connexion √©tablie, il peut envoyer et recevoir des messages en temps r√©el.

Le serveur √©coute les connexions entrantes des clients, g√®re les sessions et transmet les messages aux destinataires appropri√©s. Il est responsable de maintenir la connexion active et de relayer les messages entre les diff√©rents clients.

Ces deux composants travaillent ensemble pour offrir une communication fluide et en temps r√©el, essentielle pour de nombreuses applications modernes.

### Exemple d'impl√©mentation

L'exemple ici pr√©sent√© correspond a l'exemple du cours : https://github.com/conception-logicielle-ensai/exemples-cours/tree/main/cours-4/websocket

On repose sur la librairie l√©g√®re `websockets` et la librairie `asyncio` par practicit√©.

- **C√¥t√© serveur**

```python
import asyncio
import websockets

# Ensemble pour stocker les connexions actives
connected_clients = set()

async def broadcast(message):
    for client in connected_clients:
        await client.send(message)

async def handle_client(websocket):
    # Ajoute le client connect√© √† l'ensemble
    connected_clients.add(websocket)
    print(f"Client connect√©. Total clients : {len(connected_clients)}")

    try:
        async for message in websocket:
            print(f"Message re√ßu : {message}")
            await broadcast(f"Message d'un client : {message}")
    except websockets.exceptions.ConnectionClosed:
        print("Client d√©connect√©.")
    finally:
        # Retire le client de l'ensemble √† sa d√©connexion
        connected_clients.remove(websocket)
        print(f"Client d√©connect√©. Total clients : {len(connected_clients)}")

async def main():
    async with websockets.serve(handle_client, "localhost", 8765):
        print("Serveur WebSocket d√©marr√© sur ws://localhost:8765")
        await asyncio.Future()  # Garde le serveur actif

if __name__ == "__main__":
    asyncio.run(main())
```
> On d√©marre un serveur accesible sur le port 8765

- **C√¥t√© client**

```python
import asyncio
import websockets

async def communicate():
    uri = "ws://localhost:8765"
    async with websockets.connect(uri) as websocket:
        message = "Hello, WebSocket Server!"
        print(f"Envoi : {message}")
        await websocket.send(message)
        response = await websocket.recv()
        print(f"R√©ponse du serveur : {response}")

if __name__ == "__main__":
    asyncio.run(communicate())
```
> On s'y connecte directement puis on broadcast des messages

- Il est √©galement possible de g√©rer une session directement dans le navigateur via l'usage du `Javascript`.

```js
  const socket = new WebSocket("ws://localhost:8765");

        socket.onopen = function(event) {
            console.log("Connexion √©tablie avec le serveur WebSocket");
        };

        socket.onmessage = function(event) {
            console.log("Message re√ßu du serveur :", event.data);
            document.getElementById("messages").innerHTML += `<p>${event.data}</p>`;
        };

        socket.onclose = function(event) {
            console.log("Connexion ferm√©e");
        };

        function sendMessage() {
            const message = "Hello depuis le client javascript !";
            console.log("Envoi :", message);
            socket.send(message);
        }
```

## Travaux pratiques

Mettez en place une premi√®re architecture dans vos projets :
- D√©terminez la solution privil√©gi√©e pour votre projet a partir de ce qui a √©t√© pr√©sent√©
- Renseignez pour la s√©ance courante les technologies https://docs.google.com/spreadsheets/d/1VlfoNcXhhJ2tr3OVYCIBmzutdzA56usssL11lCISgIg/edit?usp=sharing
- En se r√©unissant par groupes, travaillez sur vos projets et pinguez nous quand vous avez besoin de nous : (colonne 4 https://docs.google.com/spreadsheets/d/1VlfoNcXhhJ2tr3OVYCIBmzutdzA56usssL11lCISgIg/edit?usp=sharing)
