---
title: üîÑ Automatisation des contr√¥les sur une base de code versionn√©e
url:  /docs/automatisation
---
## ‚ö†Ô∏è C'est en travaux, revenez plus tard !

Notre page est actuellement en cours d'√©criture et nous mettons tout en ≈ìuvre pour vous offrir la meilleure exp√©rience possible. Nous vous prions de bien vouloir patienter, elle sera remplie prochainement.

## Automatisation des contr√¥les en local


### Qu'est-ce qu'un git hooks ? 

Les hooks Git sont des scripts qui s'ex√©cutent automatiquement d√®s qu'un √©v√©nement particulier se produit dans un d√©p√¥t Git. Ils vous permettent de personnaliser le comportement interne de Git et de d√©clencher des actions personnalisables √† des points cl√©s dans le cycle de vie du d√©veloppement.

### Cr√©ation d'un hook

Nous souhaitons automatiser le formatage des fichiers qui seront inclus dans notre prochain commit. Pour cela, nous allons cr√©er un hook qui s'occupera de l'auto-formatage et de la validation au moment du commit.

En supposant que vous ayez install√© les packages n√©cessaires, sinon, tapez la commande suivante :

```bash
# Commande pour installer les packages
pip install black isort flake8
```

Pour utiliser ces packages, il vous suffit de taper les commandes suivantes √† la racine de votre projet :

```bash
python -m black
python -m isort
python -m flake8
```

- **Black** : Suit les r√®gles PEP 8 par d√©faut.
- **isort** : Organise les importations dans un ordre logique.
- **Flake8** : V√©rifie la conformit√© avec PEP 8.

Pour cela, nous allons cr√©er un fichier `pre-commit` personnalis√© directement dans le dossier `.git/hooks` de votre projet.

> Voici un lien vers un tutoriel qui explique [comment cr√©er un git hook](https://www.atlassian.com/fr/git/tutorials/git-hooks).

---

### TP cr√©eration d'un hook `pre-commit`

Pour ce TP, nous allons nous concentrer sur l'utilisation de la ligne de commande.

#####  0. **Observer le dossier `.git`**

Nous allons parcourir le dossier `.git`, qui contient des informations cruciales sur la gestion des versions de notre projet. Pour cela, nous utiliserons les commandes suivantes :

```bash
# Se d√©placer dans le r√©pertoire du projet
cd chemin/vers/ton/projet
# Afficher le contenu du dossier .git
ls -la .git
# Entrer dans le dossier .git
cd .git
# Voir le contenu du dossier .git
ls
# Acc√©der au dossier objects
cd objects
# Afficher le contenu du dossier objects
ls
# Revenir au dossier .git
cd ..
# Revenir au dossier parent du projet
cd ..
```


> - **`ls`** : Affiche la liste des fichiers et des r√©pertoires.
> - **`-l`** : Affiche les d√©tails sous forme de liste (permissions, propri√©taire, taille, etc.).
> - **`-a`** : Affiche tous les fichiers, y compris ceux qui commencent par un point (`.`), qui sont normalement cach√©s.

> **`cd`** : Permet de changer de dossier.

**Sous-dossiers importants dans `.git`**

Voici quelques exemples de sous-dossiers essentiels que vous pouvez trouver dans `.git` :

- **`objects`** : Contient les objets Git (commits, arbres, blobs).
- **`refs`** : Contient les r√©f√©rences aux branches et aux tags.
- **`config`** : Fichier de configuration du d√©p√¥t Git.


##### 1. **Cr√©er ou modifier le fichier `pre-commit`**
   Acc√©dez au dossier `.git/hooks` de votre projet et cr√©ez un fichier nomm√© `pre-commit` :

   ```bash
   touch .git/hooks/pre-commit
   ```

   > `touch` est utilis√©e pour cr√©er des fichiers vides

#####  2. **Ajouter du contenu au fichier `pre-commit`**
   Ouvrez ce fichier dans un √©diteur de texte :

   ```bash
   nano .git/hooks/pre-commit
   ```

   > `nano` est un √©diteur de texte en ligne de commande.

   Ajoutez le script suivant :

   ```bash
    #!/bin/bash

    # Chemin vers Python (modifiez si n√©cessaire)
    PYTHON_BIN=$(which python3)

    # R√©cup√©rer la liste des fichiers actuellement dans l\'index (staging area)
    STAGED_FILES=$(git diff --cached --name-only --diff-filter=d | grep '\.py$')

    if [[ -z "$STAGED_FILES" ]]; then
    echo "Aucun fichier Python √† v√©rifier."
    exit 0
    fi

    echo "Ex√©cution des v√©rifications sur les fichiers ajout√©s au staging..."

    # Formatage avec Black
    echo "Formatage avec Black..."
    $PYTHON_BIN -m black $STAGED_FILES

    # Organisation des imports avec isort
    echo "Organisation des imports avec isort..."
    $PYTHON_BIN -m isort $STAGED_FILES

    # V√©rification avec Flake8
    echo "V√©rification du style avec Flake8..."
    $PYTHON_BIN -m flake8 $STAGED_FILES
    FLAKE8_STATUS=$?

    if [[ $FLAKE8_STATUS -ne 0 ]]; then
        echo "Erreur : Flake8 a d√©tect√© des probl√®mes. Commit bloqu√©."
        exit 1
    fi

    # R√©ajouter uniquement les fichiers qui √©taient dans le staging
    echo "Ajout des fichiers modifi√©s au staging..."
    git add $STAGED_FILES

    echo "Toutes les v√©rifications sont pass√©es. Commit autoris√©."
    exit 0
   ```
   > `$(...)` est utilis√© pour ex√©cuter une commande et ins√©rer son r√©sultat dans une autre commande ou une variable.
   
   > `echo` est utilis√©e pour afficher du texte ou des variables dans le terminal. 

##### 3. **Rendre le fichier ex√©cutable**
   Rendez le fichier `pre-commit` ex√©cutable avec la commande suivante :

   ```bash
   chmod +x .git/hooks/pre-commit
   ```

   > `chmod` (abr√©viation de Change Mode) est utilis√©e en ligne de commande pour modifier les permissions d'acc√®s √† des fichiers ou des r√©pertoires

##### 4. **Tester le hook**
   Essayez de committer un fichier dans votre projet pour voir si le hook est ex√©cut√© :

   ```bash
   git add .
   git commit -m "Test du hook pre-commit"
   ```

   Si des fichiers sont modifi√©s par Black ou isort, le hook les ajoutera automatiquement au staging et r√©ex√©cutera les √©tapes.

---

### Points importants

- Si un fichier ne respecte pas les r√®gles, Flake8 bloquera le commit. Vous devrez corriger les erreurs avant de r√©essayer.
- Si vous avez besoin d'une configuration sp√©cifique pour Black, isort, ou Flake8, placez les fichiers de configuration (`pyproject.toml`, `.isort.cfg`, `.flake8`) √† la racine de votre projet.
